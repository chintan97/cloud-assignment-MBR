<div class="container" style="background-color: blue; margin-top: 5%">
        <div class = "jumbotron" style="background-color: lightgray">
   
        
    <h1 class="display-4 text-center">Mortgage Form</h1>
   
        
    <br>
    <div class="row text-center">

            <!-- COLUMN 1 -->
            <div class="col-sm-4"></div>
          
            <!-- COLUMN 2 -->
            <div class="col-sm-4">
          
                <form id="kemcho">

                    <p class="text-center" id="user" name="user"><%=req.session.userid%></p>
                    <div class="form-group">
                      <label for="mid"><strong>Mortgage Id:</strong></label>
                      <input type="mid" name="mid" class="form-control" id="mid">
                    </div>
                
                    <div class="form-group">
                      <label for="lnk"><strong>Link:</strong></label>
                      <input type="lnk" name="lnk" class="form-control" id="lnk">
                      <p class="text-danger" id="linkTest"></p>
                    </div>
                
                    <br>
                    <p>By clicking "Agree" I give consent to providing personal information to an external party.</p>
                    <button type="submit" class="btn btn-primary">Agree</button>
                  </form>
          
            </div>
          
            <!-- COLUMN 3 -->
            <div class="col-sm-4"></div>
            <!--Login FORM-->
          
          </div>
          
</div>
</div>
    </div>

    <p id="result"></p>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script type="text/javascript">

(function($){

  function retrieveEmployeeData(e){
    console.log("[retrieveEmployeeData] Function Called");
    var userId = $('#user').text();
    var myData = { id: userId };

    $.ajax({
        url: 'http://localhost:1338/employer/retrieveData',
        dataType: 'jsonp',
        type: 'POST',
        data: myData,
        success: function(data){

          console.log("[retreiveData] Success");
          submitEmployeeToBrocker(e, data.Employee);

        },
        error: function(error){
            console.log("[retreiveData] Error occured");
            console.log(error);
        }
    });

    //prevent the error from taking the user from the default page
    e.preventDefault();
  }

  function submitEmployeeToBrocker(e, employee){
    
    console.log("[submitEmployeeToBrocker] Function Called");
    
    var mortgageID = $('#mid').val();
    var webserviceurl = $('#lnk').val();

    console.log(webserviceurl)
    e.preventDefault();
    $.ajax({
        //url: 'http://localhost:1338/validateApplication',
        url: webserviceurl + "/validateApplication",
        type: 'POST', 
        data: {
          "mortgageID": mortgageID,
          "employeeName": employee.userId,
          "webServiceLink":webserviceurl,
          "employer_name": employee.employerName,
          "salary": employee.salary,
          "employment_length": employee.employmentLengthYears,
        },
        dataType: 'json',
        crossDomain:true,
        success: function(data){

          if(data.status == "ERROR")
          {
            $("#result").html("Error : " + data.error_message);
          }
          else{
            $("#result").html("Result : " + data.status);
          }
        },
        error: function(error){
          $("#result").html("Error : Oops, there seems to be an error with the web service. Please try again later.");
          console.log("[submitEmployeeToBrocker] Error occured");
          console.log(error);
        }
    });

    e.preventDefault();
  }

  $('#kemcho').submit( retrieveEmployeeData );

})(jQuery);

</script>